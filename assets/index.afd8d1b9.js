var M=Object.defineProperty;var T=(l,e,t)=>e in l?M(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var s=(l,e,t)=>(T(l,typeof e!="symbol"?e+"":e,t),t);const b=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}};b();class h{constructor(e,t=Math.random()>.8?4:2){s(this,"_element");s(this,"_value");s(this,"_x");s(this,"_y");this._element=document.createElement("li"),this._element.setAttribute("data-tile",""),e.element.append(this._element),this.value=t}get value(){return this._value}get element(){return this._element}set value(e){this._value=e,this.element.textContent=`${e}`,this.element.setAttribute("data-value",`${e}`)}get x(){return this._x}set x(e){this._x=e,this.element.style.setProperty("--x",`${e}`)}get y(){return this._y}set y(e){this._y=e,this.element.style.setProperty("--y",`${e}`)}waitForTransition(e=!1){return new Promise(t=>{this.element.addEventListener(e?"animationend":"transitionend",t,{once:!0})})}remove(){this.element.remove()}}const m={down:l=>l.cellsByColumn.map(e=>[...e].reverse()),right:l=>l.cellsByRow.map(e=>[...e].reverse()),up:l=>l.cellsByColumn,left:l=>l.cellsByRow};class f{constructor(e){s(this,"_board");s(this,"_events",{});this._board=e,this.bindEvents()}bindEvents(){window.addEventListener("keydown",e=>this.move(e.key.replace("Arrow","").toLowerCase()),{once:!0})}async move(e){if(this.isEnded())return this.trigger("gameEnded");e in m?await this.slide(m[e](this._board)):this.bindEvents(),this.trigger("moved")}isEnded(){return Object.keys(m).every(e=>!this.canMove(m[e](this._board)))}canMove(e){return e.some(t=>t.some((n,r)=>r===0||n.tile===null?!1:t[r-1].canAccept(n.tile)))}async slide(e){this.canMove(e)&&(await f.slideTiles(e),this._board.cells.forEach(t=>{const n=t.mergeTiles();n!==0&&this.trigger("scoreUp",n)}),this._board.randomEmptyCell().tile=new h(this._board)),this.bindEvents()}static slideTiles(e){return Promise.all(e.flatMap(t=>{const n=[];for(let r=1;r<t.length;r++){const i=t[r];if(i.tile===null)continue;let a;for(let d=r-1;d>=0;d--){const _=t[d];if(!_.canAccept(i.tile))break;a=_}a&&(n.push(i.tile.waitForTransition()),a.tile?a.tileToMerge=i.tile:a.tile=i.tile,i.tile=null)}return n}))}on(e,t){this._events[e]=t}trigger(e,...t){this._events[e]&&this._events[e](...t)}}class w{constructor(e,t){s(this,"_x");s(this,"_y");s(this,"_element");s(this,"_tile",null);s(this,"_tileToMerge",null);this._x=e,this._y=t;const n=document.createElement("li");n.setAttribute("data-cell",""),this._element=n}get x(){return this._x}get y(){return this._y}get element(){return this._element}get tile(){return this._tile}set tile(e){this._tile=e,this.tile!==null&&(this.tile.x=this.x,this.tile.y=this.y)}get tileToMerge(){return this._tileToMerge}set tileToMerge(e){this._tileToMerge=e,this.tileToMerge!==null&&(this.tileToMerge.x=this.x,this.tileToMerge.y=this.y)}canAccept(e){return this.tile===null||this.tileToMerge===null&&this.tile.value===e.value}mergeTiles(){return this.tile==null||this.tileToMerge==null?0:(this.tile.value+=this.tileToMerge.value,this.tileToMerge.remove(),this.tileToMerge=null,this.tile.value)}removeTiles(){var e,t;(e=this.tile)==null||e.remove(),(t=this.tileToMerge)==null||t.remove(),this.tileToMerge=null,this.tile=null}}const u=4;class E{constructor(e){s(this,"_cells",[]);s(this,"_element");if(e==null)throw new Error("Board cannot be null");e.style.setProperty("--grid-size",u.toString()),this._element=e,Array(u*u).fill(0).map((t,n)=>{const r=new w(n%u,Math.floor(n/u));this._element.append(r.element),this._cells.push(r)})}get element(){return this._element}get cells(){return this._cells}get emptyCells(){return this.cells.filter(e=>e.tile===null)}randomEmptyCell(){const e=Math.floor(Math.random()*this.emptyCells.length);return this.emptyCells[e]}get cellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}get cellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}}const c=document.querySelector("[data-score]"),p=document.querySelector("[data-best]"),g=document.querySelector("[data-message]"),x=g.querySelector("button"),o=new E(document.querySelector("[data-board]")),y=new f(o);o.randomEmptyCell().tile=new h(o);o.randomEmptyCell().tile=new h(o);x.addEventListener("click",()=>{g.classList.remove("visible"),o.cells.forEach(l=>l.removeTiles()),o.randomEmptyCell().tile=new h(o),o.randomEmptyCell().tile=new h(o),c.innerHTML=`${0}`});y.on("scoreUp",l=>{c.innerHTML=`${+c.innerHTML+l}`});y.on("gameEnded",()=>{+c.innerHTML>+localStorage.getItem("best-score")&&(localStorage.setItem("best-score",c.innerHTML),p.innerHTML=c.innerHTML),g.classList.add("visible"),y.bindEvents()});var v;p.innerHTML=(v=localStorage.getItem("best-score"))!=null?v:"0";
